<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Quiz Interactif</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        position: relative;
      }
      .header {
        background-color: #4caf50;
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }
      .quiz-container {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .progress {
        background-color: #e0e0e0;
        border-radius: 10px;
        height: 10px;
        margin-bottom: 20px;
        overflow: hidden;
      }
      .progress-bar {
        background-color: #4caf50;
        height: 100%;
        transition: width 0.3s ease;
      }
      .question-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .theme {
        background-color: #ff9800;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
      }
      .question-text {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 25px;
        color: #333;
        line-height: 1.4;
      }
      .answer-option {
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 16px;
      }
      .answer-option:hover {
        background-color: #e3f2fd;
        border-color: #2196f3;
      }
      .answer-option.selected {
        background-color: #2196f3;
        color: white;
        border-color: #1976d2;
      }
      .answer-option.queued {
        background-color: #ff9800;
        color: white;
        border-color: #f57c00;
        position: relative;
      }
      .answer-option.queued::after {
        content: '‚è≥ En attente';
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        font-weight: bold;
      }
      .previous-answer {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
      }
      .previous-answer.correct {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .previous-answer.incorrect {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .submit-btn {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
        transition: background-color 0.3s;
      }
      .submit-btn:hover {
        background-color: #45a049;
      }
      .submit-btn:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .start-btn {
        background-color: #2196f3;
        color: white;
        border: none;
        padding: 20px 40px;
        font-size: 18px;
        border-radius: 8px;
        cursor: pointer;
        display: block;
        margin: 0 auto;
      }
      .results {
        text-align: center;
        padding: 30px;
      }
      .score {
        font-size: 48px;
        font-weight: bold;
        color: #4caf50;
        margin-bottom: 20px;
      }
      .status {
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 20px;
      }
      .status.connected {
        background-color: #d4edda;
        color: #155724;
      }
      .status.disconnected {
        background-color: #f8d7da;
        color: #721c24;
      }
      .player-stats {
        background-color: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-around;
        text-align: center;
      }
      .stat-item {
        flex: 1;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #2196f3;
      }
      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }
      .watch-mode {
        background-color: #ff5722;
        color: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 20px;
        font-weight: bold;
        animation: pulse 2s infinite;
      }
      .timer {
        background-color: #2196f3;
        color: white;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 15px;
        font-size: 18px;
        font-weight: bold;
      }
      .timer.warning {
        background-color: #ff9800;
        animation: pulse 1s infinite;
      }
      .timer.danger {
        background-color: #f44336;
        animation: pulse 0.5s infinite;
      }
      .next-event {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
      }
      .lobby-section {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
      }
      .countdown {
        font-size: 24px;
        font-weight: bold;
        margin: 15px 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
      }
      .event-banner {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
        font-weight: bold;
        animation: eventPulse 3s infinite;
      }
      .winner-announcement {
        background: linear-gradient(45deg, #ffd700, #ffed4e);
        color: #333;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        margin: 20px 0;
        font-weight: bold;
        box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
        animation: winnerGlow 2s infinite;
      }
      .winner-crown {
        font-size: 48px;
        margin-bottom: 10px;
        animation: bounce 1s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes eventPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }
      @keyframes winnerGlow {
        0%,
        100% {
          box-shadow: 0 8px 16px rgba(255, 215, 0, 0.3);
        }
        50% {
          box-shadow: 0 12px 24px rgba(255, 215, 0, 0.6);
        }
      }
      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      /* Chambre d'attente plein √©cran */
      .waiting-room {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        color: white;
        text-align: center;
      }

      .waiting-room-content {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .waiting-room h2 {
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .waiting-room-icon {
        font-size: 4em;
        margin-bottom: 20px;
        animation: pulse 2s infinite;
      }

      .participants-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 15px;
        margin: 30px 0;
        max-width: 400px;
      }

      .participant-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: bold;
        color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        animation: fadeInUp 0.5s ease;
      }

      .leave-lobby-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .leave-lobby-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Am√©liorations visuelles */
      .quiz-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 20px;
        text-align: center;
        box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
      }

      .lobby-section {
        background: linear-gradient(45deg, #f093fb, #f5576c);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 20px;
        box-shadow: 0 10px 20px rgba(240, 147, 251, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .next-event {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 20px;
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .start-btn,
      .submit-btn {
        background: linear-gradient(45deg, #2196f3, #1976d2);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        text-transform: uppercase;
        font-weight: bold;
        letter-spacing: 1px;
      }

      .back-btn {
        background: linear-gradient(45deg, #757575, #616161);
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 14px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 10px;
      }

      .mode-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 30px 0;
      }

      .mode-card {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(33, 150, 243, 0.2);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .mode-card:hover {
        border-color: #2196f3;
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(33, 150, 243, 0.2);
      }

      .mode-icon {
        font-size: 3em;
        margin-bottom: 15px;
      }

      .mode-card h3 {
        color: #333;
        margin: 15px 0;
      }

      .mode-card p {
        color: #666;
        margin-bottom: 15px;
      }

      .mode-card ul {
        text-align: left;
        color: #555;
        font-size: 14px;
      }

      .button-group {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
      }

      .answer-feedback {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        z-index: 1000;
        animation: feedbackPop 0.5s ease;
      }

      @keyframes feedbackPop {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      .info-message {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(33, 150, 243, 0.3);
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        margin: 20px 0;
        backdrop-filter: blur(5px);
      }

      .info-icon {
        font-size: 3em;
        margin-bottom: 15px;
        opacity: 0.7;
      }

      .info-message h3 {
        color: #333;
        margin: 15px 0;
      }

      .info-message p {
        color: #666;
        margin: 10px 0;
        line-height: 1.5;
      }

      .start-btn:hover,
      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      }

      .answer-option {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(33, 150, 243, 0.2);
        border-radius: 12px;
        padding: 18px;
        margin: 12px 0;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 16px;
        backdrop-filter: blur(5px);
      }

      .answer-option:hover {
        background: rgba(33, 150, 243, 0.1);
        border-color: #2196f3;
        transform: translateX(5px);
      }

      .status.connected {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border-radius: 25px;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      }

      .status.disconnected {
        background: linear-gradient(45deg, #f44336, #d32f2f);
        color: white;
        border-radius: 25px;
        box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üéØ Quiz Interactif</h1>
      <p>R√©pondez aux questions une par une</p>
    </div>
    <div id="status" class="status disconnected">Connexion en cours...</div>
    <!-- Chambre d'attente plein √©cran -->
    <div id="waiting-room" class="waiting-room">
      <div class="waiting-room-content">
        <div class="waiting-room-icon">üéØ</div>
        <h2>Chambre d'Attente</h2>
        <div id="waiting-event-details"></div>
        <div id="waiting-countdown" class="countdown"></div>
        <div class="participants-grid" id="participants-grid">
          <!-- Les avatars des participants seront ajout√©s ici -->
        </div>
        <div id="waiting-status"></div>
        <button class="leave-lobby-btn" onclick="leaveLobby()">
          Quitter le Lobby
        </button>
      </div>
    </div>
    <div id="event-banner" class="event-banner" style="display: none">
      <div>üéâ √âV√âNEMENT EN COURS üéâ</div>
      <div id="event-details"></div>
    </div>
    <div id="player-stats" class="player-stats" style="display: none">
      <div class="stat-item">
        <div id="active-players" class="stat-number">0</div>
        <div class="stat-label">Joueurs actifs</div>
      </div>
      <div class="stat-item">
        <div id="watching-players" class="stat-number">0</div>
        <div class="stat-label">En surveillance</div>
      </div>
      <div class="stat-item">
        <div id="total-players" class="stat-number">0</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
    <div id="quiz-container" class="quiz-container">
      <!-- S√©lection du mode -->
      <div id="mode-selection">
        <h2>üéÆ Choisissez votre mode de jeu</h2>
        <div class="mode-buttons">
          <div class="mode-card" onclick="selectMode('solo')">
            <div class="mode-icon">üë§</div>
            <h3>Mode Solo</h3>
            <p>Jouez seul √† votre rythme</p>
            <ul>
              <li>‚úÖ 10 questions al√©atoires</li>
              <li>‚úÖ Correction imm√©diate</li>
              <li>‚úÖ Score personnel</li>
            </ul>
          </div>
          <div
            class="mode-card"
            onclick="selectMode('multiplayer')"
            id="multiplayer-mode-card"
          >
            <div class="mode-icon">üë•</div>
            <h3>Mode Multijoueur</h3>
            <p>Affrontez d'autres joueurs</p>
            <ul>
              <li>üèÜ √âv√©nements programm√©s</li>
              <li>üéØ Comp√©tition en temps r√©el</li>
              <li>üëë Classement global</li>
            </ul>
            <!-- Zone dynamique ajout√©e ici -->
            <div id="multiplayer-card-dynamic"></div>
          </div>
        </div>
      </div>
      <!-- Configuration Solo -->
      <div id="solo-config" style="display: none">
        <h2>‚öôÔ∏è Configuration Solo</h2>
        <div style="margin: 20px 0">
          <label style="font-weight: bold; color: #333"
            >üéØ Th√®me (optionnel):</label
          ><br />
          <input
            type="text"
            id="solo-theme"
            placeholder="Ex: Histoire, Science, Sport..."
            style="
              width: 100%;
              padding: 12px;
              margin: 8px 0;
              border: 2px solid #e0e0e0;
              border-radius: 8px;
              font-size: 16px;
              transition: border-color 0.3s;
            "
          />
        </div>
        <div class="button-group">
          <button class="start-btn" onclick="startSoloQuiz()">
            üöÄ Commencer Solo
          </button>
          <button class="back-btn" onclick="backToModeSelection()">
            ‚Üê Retour
          </button>
        </div>
      </div>
      <!-- Configuration Multijoueur -->
      <div id="multiplayer-config" style="display: none">
        <h2>üåê Mode Multijoueur</h2>
        <p>Rejoignez des √©v√©nements programm√©s et affrontez d'autres joueurs</p>
        <!-- Prochain √©v√©nement dans le multiplayer -->
        <div id="mp-next-event" class="next-event" style="display: none">
          <h3>üìÖ Prochain √âv√©nement</h3>
          <div id="mp-next-event-details"></div>
          <div id="mp-event-countdown" class="countdown"></div>
        </div>
        <!-- Lobby ouvert dans le multiplayer -->
        <div id="mp-lobby-section" class="lobby-section" style="display: none">
          <h3>üö™ Lobby Ouvert</h3>
          <div id="mp-lobby-details"></div>
          <div id="mp-lobby-countdown" class="countdown"></div>
          <div id="mp-lobby-participants"></div>
          <button
            id="mp-join-lobby-btn"
            class="start-btn"
            onclick="joinLobby()"
          >
            Rejoindre le Lobby
          </button>
        </div>
        <div id="no-lobby-message" class="info-message">
          <div class="info-icon">‚è≥</div>
          <h3>Aucun √©v√©nement disponible</h3>
          <p>
            Les lobbies s'ouvrent automatiquement 5 minutes avant chaque
            √©v√©nement programm√©.
          </p>
          <p>Restez connect√© pour √™tre notifi√© d√®s qu'un lobby s'ouvre !</p>
        </div>
        <div class="button-group">
          <button class="back-btn" onclick="backToModeSelection()">
            ‚Üê Retour
          </button>
        </div>
      </div>
      <!-- √âl√©ments cach√©s pour la synchronisation -->
      <div style="display: none">
        <div id="next-event" class="next-event">
          <h3>üìÖ Prochain √âv√©nement</h3>
          <div id="next-event-details"></div>
          <div id="event-countdown" class="countdown"></div>
        </div>
        <div id="lobby-section" class="lobby-section">
          <h3>üö™ Lobby Ouvert</h3>
          <div id="lobby-details"></div>
          <div id="lobby-countdown" class="countdown"></div>
          <div id="lobby-participants"></div>
          <button id="join-lobby-btn" class="start-btn" onclick="joinLobby()">
            Rejoindre le Lobby
          </button>
        </div>
      </div>
      <div id="question-screen" style="display: none">
        <div class="progress">
          <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
        </div>
        <div id="previous-answer" class="previous-answer" style="display: none">
          <h4>R√©sultat de la question pr√©c√©dente :</h4>
          <p id="previous-question"></p>
          <p id="previous-result"></p>
        </div>
        <div class="question-info">
          <span id="question-theme" class="theme"></span>
          <span id="question-counter"></span>
        </div>
        <div id="question-text" class="question-text"></div>
        <div id="answers-container"></div>
        <button
          id="submit-btn"
          class="submit-btn"
          onclick="submitAnswer()"
          disabled
        >
          Mettre en file d'attente
        </button>
        <p
          style="
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 10px;
          "
        >
          Vous pouvez modifier votre r√©ponse jusqu'√† l'expiration du timer
        </p>
      </div>
      <div id="results-screen" style="display: none">
        <div class="results">
          <h2>üéâ Quiz termin√© !</h2>
          <div
            id="winner-announcement"
            class="winner-announcement"
            style="display: none"
          >
            <div class="winner-crown">üëë</div>
            <div id="winner-message"></div>
          </div>
          <div id="final-score" class="score"></div>
          <p id="score-message"></p>
          <button class="start-btn" onclick="restartQuiz()">
            üîÑ Recommencer
          </button>
        </div>
      </div>
    </div>
    <script>
      const socket = io('http://localhost:80');
      let currentQuestion = null;
      let selectedAnswer = null;
      let gameMode = null;
      let soloQuestions = [];
      let currentSoloIndex = 0;
      let soloScore = 0;
      let soloTimerInterval = null;
      let soloTimeLeft = 30;
      // Elements
      const statusElement = document.getElementById('status');
      const questionScreen = document.getElementById('question-screen');
      const resultsScreen = document.getElementById('results-screen');
      const progressBar = document.getElementById('progress-bar');
      const previousAnswerDiv = document.getElementById('previous-answer');
      const questionTheme = document.getElementById('question-theme');
      const questionCounter = document.getElementById('question-counter');
      const questionText = document.getElementById('question-text');
      const answersContainer = document.getElementById('answers-container');
      const submitBtn = document.getElementById('submit-btn');
      let currentTimeLeft = 0;
      let lobbyOpen = false;
      let pendingLobbyCheck = false;

      // === NOUVELLES FONCTIONS ===
      function updateMultiplayerCard(event = null, lobby = null) {
        const dynamicDiv = document.getElementById('multiplayer-card-dynamic');
        if (lobby) {
          dynamicDiv.innerHTML = `
          <div style="background: rgba(255, 235, 59, 0.2);">
            <strong>üö™ Lobby ouverte !</strong><br>
            <small>Th√®me : ${lobby.theme}</small><br>
            <button class="start-btn" style="padding: 6px 12px; font-size: 14px; margin-top: 8px;" 
                    onclick="event.stopPropagation(); joinLobbyFromCard();">
              Rejoindre le Lobby
            </button>
          </div>
        `;
        } else if (event) {
          const start = new Date(event.startDate).toLocaleString('fr-FR');
          dynamicDiv.innerHTML = `
          <div style="background: rgba(33, 150, 243, 0.1);">
            <strong>üìÖ Prochain √©v√©nement :</strong><br>
            <small>Th√®me : ${event.theme}</small><br>
            <small>D√©but : ${start}</small>
          </div>
        `;
        } else {
          dynamicDiv.innerHTML = '<em>‚è≥ Aucun √©v√©nement pr√©vu</em>';
        }
      }

      function joinLobbyFromCard() {
        joinLobby();
      }
      // ===========================

      // Socket events
      socket.on('connect', () => {
        statusElement.textContent = `‚úÖ Connect√© au serveur`;
        statusElement.className = 'status connected';
        // Demander l'√©tat du lobby √† la connexion pour √©viter les incoh√©rences
        socket.emit('requestLobbyStatus');
      });
      socket.on('disconnect', () => {
        statusElement.textContent = '‚ùå D√©connect√© - Reconnexion...';
        statusElement.className = 'status disconnected';
      });
      socket.on('quizQuestion', (data) => {
        displayQuestion(data);
      });
      socket.on('soloQuestions', (data) => {
        soloQuestions = data.questions;
        currentSoloIndex = 0;
        soloScore = 0;
        displaySoloQuestion();
      });
      socket.on('quizCompleted', (results) => {
        showResults(results);
      });
      socket.on('timerUpdate', (data) => {
        updateTimer(data.timeLeft, data.hasPendingAnswer);
      });
      socket.on('answerQueued', (data) => {
        showAnswerQueued(data.answer);
      });
      socket.on('playerStats', (stats) => {
        updatePlayerStats(stats);
      });
      socket.on('error', (error) => {
        alert(error.message);
      });
      socket.on('eventStarted', (data) => {
        showEventBanner(data.event);
      });
      socket.on('eventCompleted', (data) => {
        hideEventBanner();
      });
      socket.on('nextEvent', (event) => {
        showNextEvent(event);
        // Mise √† jour de la carte multijoueur
        if (
          document.getElementById('lobby-section').style.display !== 'block'
        ) {
          updateMultiplayerCard(event, null);
        }
      });
      socket.on('lobbyOpened', (data) => {
        console.log('Lobby ouvert re√ßu:', data);
        showLobby(data.event);
        // Mise √† jour de la carte avec le lobby
        updateMultiplayerCard(null, data.event);
        lobbyOpen = true;
      });
      socket.on('eventCountdown', (data) => {
        updateEventCountdown(data.timeLeft, data.participants, data.minPlayers);
      });
      socket.on('lobbyJoined', (data) => {
        showLobbyJoined(data);
      });
      socket.on('lobbyUpdate', (data) => {
        updateLobbyParticipants(data.participants, data.minPlayers);
      });
      socket.on('eventCancelled', (data) => {
        showEventCancelled(data);
        // R√©initialiser la carte
        updateMultiplayerCard(null, null);
        lobbyOpen = false;
      });
      socket.on('eventUpdated', (event) => {
        // Met √† jour la carte
        if (document.getElementById('lobby-section').style.display === 'block') {
          // Si le lobby est visible, rafra√Æchir les infos du lobby et la waiting room
          showLobby(event);
          window.currentEvent = event;
          if (document.getElementById('waiting-room').style.display === 'flex') {
            const eventDetails = document.getElementById('waiting-event-details');
            eventDetails.innerHTML = `
              <h3>üéØ ${event.theme}</h3>
              <p>üìù ${event.numberOfQuestions} questions</p>
              <p>üë• ${event.minPlayers} joueurs minimum</p>
            `;
          }
          updateMultiplayerCard(null, event);
        } else if (document.getElementById('next-event').style.display === 'block') {
          // Si on affiche le prochain √©v√©nement, rafra√Æchir
          showNextEvent(event);
          updateMultiplayerCard(event, null);
        } else {
          // √âcran neutre: juste mettre √† jour la carte
          updateMultiplayerCard(event, null);
        }
      });

      // R√©ception du statut du lobby √† la demande
      socket.on('lobbyStatus', (data) => {
        lobbyOpen = data.isOpen === true;
        if (data.isOpen && data.event) {
          // Afficher imm√©diatement le lobby si d√©j√† ouvert
          showLobby(data.event);
          window.currentEvent = data.event;
          updateMultiplayerCard(null, data.event);
        }
      });
      socket.on('lobbyLeft', (data) => {
        document.getElementById('waiting-room').style.display = 'none';
        document.body.style.overflow = 'auto';
      });
      socket.on('autoStartQuiz', (data) => {
        document.getElementById('lobby-section').style.display = 'none';
        document.getElementById('waiting-room').style.display = 'none';
        document.body.style.overflow = 'auto';
        questionScreen.style.display = 'block';
        showNotification('üöÄ Le quiz commence maintenant!', 'success');
      });
      // Confirmation de jonction d'un √©v√©nement en cours (player ou watcher)
      socket.on('joinedInProgress', (data) => {
        document.getElementById('lobby-section').style.display = 'none';
        document.getElementById('waiting-room').style.display = 'none';
        document.body.style.overflow = 'auto';
        questionScreen.style.display = 'block';
        const msg = data?.mode === 'play'
          ? 'üéÆ Rejoint l\'√©v√©nement en cours comme joueur (Q1)'
          : 'üëÄ Rejoint l\'√©v√©nement en cours en mode surveillance';
        showNotification(msg, 'success');
      });

      function selectMode(mode) {
        gameMode = mode;
        document.getElementById('mode-selection').style.display = 'none';
        if (mode === 'solo') {
          document.getElementById('solo-config').style.display = 'block';
        } else {
          document.getElementById('multiplayer-config').style.display = 'block';
          updateMultiplayerStatus();
          // √Ä l'entr√©e du mode multijoueur, re-demander l'√©tat du lobby
          socket.emit('requestLobbyStatus');
        }
      }
      function backToModeSelection() {
        document.getElementById('mode-selection').style.display = 'block';
        document.getElementById('solo-config').style.display = 'none';
        document.getElementById('multiplayer-config').style.display = 'none';
        gameMode = null;
      }
      function startSoloQuiz() {
        const theme = document.getElementById('solo-theme')?.value || null;
        socket.emit('startSoloQuiz', { theme });
        document.getElementById('solo-config').style.display = 'none';
        questionScreen.style.display = 'block';
      }

      // ... (le reste des fonctions displayQuestion, submitAnswer, etc. reste inchang√©) ...

      function displayQuestion(data) {
        currentQuestion = data.question;
        selectedAnswer = null;
        currentTimeLeft = data.timeLeft;
        if (data.activePlayers !== undefined) {
          updatePlayerStats({
            activePlayers: data.activePlayers,
            watchingPlayers: data.watchingPlayers,
            totalPlayers: data.totalPlayers,
          });
        }
        let watchModeHtml = '';
        if (data.isWatching) {
          watchModeHtml =
            '<div class="watch-mode">üîç MODE SURVEILLANCE ACTIV√â - Quiz rejoint en cours !</div>';
        }
        const timerHtml =
          '<div id="timer" class="timer">‚è±Ô∏è Temps restant: <span id="time-display">' +
          currentTimeLeft +
          '</span>s</div>';
        const progress = (data.questionNumber / data.totalQuestions) * 100;
        progressBar.style.width = progress + '%';
        if (data.previousAnswer) {
          previousAnswerDiv.style.display = 'block';
          const prevAnswer = data.previousAnswer;
          previousAnswerDiv.className = `previous-answer ${prevAnswer.correct ? 'correct' : 'incorrect'}`;
          document.getElementById('previous-question').textContent =
            'Question pr√©c√©dente';
          const answerText =
            prevAnswer.userAnswer === 0
              ? 'Temps expir√©'
              : prevAnswer.userAnswer;
          document.getElementById('previous-result').innerHTML =
            `Votre r√©ponse: ${answerText} | ${prevAnswer.correct ? '‚úÖ Correct !' : '‚ùå Incorrect'}`;
        } else {
          previousAnswerDiv.style.display = 'none';
        }
        questionTheme.textContent = currentQuestion.theme;
        questionCounter.textContent = `Question ${data.questionNumber}/${data.totalQuestions}`;
        questionText.textContent = currentQuestion.questionText;
        answersContainer.innerHTML = watchModeHtml + timerHtml;
        const optionLabels = ['A', 'B', 'C', 'D'];
        for (let i = 1; i <= 4; i++) {
          const option = document.createElement('div');
          option.className = 'answer-option';
          option.innerHTML = `<strong>${optionLabels[i - 1]}.</strong> ${currentQuestion[`response${i}`]}`;
          if (!data.isWatching) {
            option.onclick = () => selectAnswer(i, option);
          } else {
            option.style.cursor = 'not-allowed';
            option.style.opacity = '0.6';
          }
          answersContainer.appendChild(option);
        }
        submitBtn.disabled = data.isWatching || true;
        if (data.isWatching) {
          submitBtn.textContent = 'Mode surveillance - Lecture seule';
          submitBtn.style.backgroundColor = '#cccccc';
        }
      }
      function updateTimer(timeLeft, hasPendingAnswer) {
        currentTimeLeft = timeLeft;
        const timerElement = document.getElementById('timer');
        const timeDisplay = document.getElementById('time-display');
        if (timeDisplay) {
          let timerText = timeLeft;
          if (hasPendingAnswer) {
            timerText += ' (r√©ponse en attente)';
          }
          timeDisplay.textContent = timerText;
          if (timeLeft <= 5) {
            timerElement.className = 'timer danger';
          } else if (timeLeft <= 10) {
            timerElement.className = 'timer warning';
          } else {
            timerElement.className = 'timer';
          }
        }
      }
      function showAnswerQueued(answer) {
        document.querySelectorAll('.answer-option').forEach((opt, index) => {
          opt.classList.remove('selected', 'queued');
          if (index + 1 === answer) {
            opt.classList.add('queued');
          }
        });
      }
      function selectAnswer(answerNum, element) {
        document.querySelectorAll('.answer-option').forEach((opt) => {
          opt.classList.remove('selected');
        });
        element.classList.add('selected');
        selectedAnswer = answerNum;
        submitBtn.disabled = false;
      }
      function submitAnswer() {
        if (selectedAnswer && currentQuestion) {
          if (gameMode === 'solo') {
            handleSoloAnswer();
          } else {
            socket.emit('submitAnswer', {
              questionId: currentQuestion.id,
              answer: selectedAnswer,
            });
            submitBtn.disabled = true;
          }
        }
      }
      function displaySoloQuestion() {
        if (currentSoloIndex >= soloQuestions.length) {
          showSoloResults();
          return;
        }

        // Nettoyer le timer pr√©c√©dent
        if (soloTimerInterval) {
          clearInterval(soloTimerInterval);
          soloTimerInterval = null;
        }

        currentQuestion = soloQuestions[currentSoloIndex];
        selectedAnswer = null;
        soloTimeLeft = 30; // R√©initialiser le timer

        const progress = ((currentSoloIndex + 1) / soloQuestions.length) * 100;
        progressBar.style.width = progress + '%';
        previousAnswerDiv.style.display = 'none';
        questionTheme.textContent = currentQuestion.theme;
        questionCounter.textContent = `Question ${currentSoloIndex + 1}/${soloQuestions.length}`;
        questionText.textContent = currentQuestion.questionText;

        // Ajouter le timer au conteneur
        answersContainer.innerHTML = `
    <div id="solo-timer" class="timer">‚è±Ô∏è Temps restant: <span id="solo-time-display">30</span>s</div>
  `;

        const optionLabels = ['A', 'B', 'C', 'D'];
        for (let i = 1; i <= 4; i++) {
          const option = document.createElement('div');
          option.className = 'answer-option';
          option.innerHTML = `<strong>${optionLabels[i - 1]}.</strong> ${currentQuestion[`response${i}`]}`;
          option.onclick = () => selectAnswer(i, option);
          answersContainer.appendChild(option);
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Valider la r√©ponse';

        // D√©marrer le timer
        soloTimerInterval = setInterval(() => {
          soloTimeLeft--;
          document.getElementById('solo-time-display').textContent =
            soloTimeLeft;

          if (soloTimeLeft <= 5) {
            document.getElementById('solo-timer').className = 'timer danger';
          } else if (soloTimeLeft <= 10) {
            document.getElementById('solo-timer').className = 'timer warning';
          } else {
            document.getElementById('solo-timer').className = 'timer';
          }

          if (soloTimeLeft <= 0) {
            clearInterval(soloTimerInterval);
            soloTimerInterval = null;
            handleSoloTimeExpired();
          }
        }, 1000);
      }

      function handleSoloTimeExpired() {
        // Aucune r√©ponse = incorrect
        showAnswerFeedback(false, currentQuestion.correctResponse);

        // D√©sactiver les options
        document.querySelectorAll('.answer-option').forEach((opt) => {
          opt.style.pointerEvents = 'none';
          opt.style.opacity = '0.7';
        });

        // Mettre en √©vidence la bonne r√©ponse
        document.querySelectorAll('.answer-option').forEach((opt, index) => {
          if (index + 1 === currentQuestion.correctResponse) {
            opt.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            opt.style.color = 'white';
          }
        });

        // Passer √† la question suivante apr√®s 2s
        setTimeout(() => {
          currentSoloIndex++;
          displaySoloQuestion();
        }, 2000);
      }

      function handleSoloAnswer() {
        if (soloTimerInterval) {
          clearInterval(soloTimerInterval);
          soloTimerInterval = null;
        }

        const isCorrect = selectedAnswer === currentQuestion.correctResponse;
        if (isCorrect) soloScore++;

        showAnswerFeedback(isCorrect, currentQuestion.correctResponse);

        document.querySelectorAll('.answer-option').forEach((opt) => {
          opt.style.pointerEvents = 'none';
          opt.style.opacity = '0.7';
        });

        document.querySelectorAll('.answer-option').forEach((opt, index) => {
          if (index + 1 === currentQuestion.correctResponse) {
            opt.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            opt.style.color = 'white';
          } else if (index + 1 === selectedAnswer && !isCorrect) {
            opt.style.background = 'linear-gradient(45deg, #f44336, #d32f2f)';
            opt.style.color = 'white';
          }
        });

        setTimeout(() => {
          currentSoloIndex++;
          displaySoloQuestion();
        }, 2000);
      }

      function showAnswerFeedback(isCorrect, correctAnswer) {
        const feedback = document.createElement('div');
        feedback.className = 'answer-feedback';
        feedback.innerHTML = isCorrect
          ? '‚úÖ Correct!'
          : `‚ùå Incorrect!<br>Bonne r√©ponse: ${['A', 'B', 'C', 'D'][correctAnswer - 1]}`;
        document.body.appendChild(feedback);
        setTimeout(() => {
          feedback.remove();
        }, 1800);
      }
      function showSoloResults() {
        if (soloTimerInterval) {
          clearInterval(soloTimerInterval);
          soloTimerInterval = null;
        }
        questionScreen.style.display = 'none';
        resultsScreen.style.display = 'block';
        const percentage = Math.round((soloScore / soloQuestions.length) * 100);
        document.getElementById('final-score').textContent =
          `${soloScore}/${soloQuestions.length}`;
        let message = '';
        if (percentage >= 90) {
          message = 'üèÜ Parfait! Vous √™tes un expert!';
        } else if (percentage >= 80) {
          message = 'üåü Excellent! Tr√®s bien jou√©!';
        } else if (percentage >= 70) {
          message = 'üëç Bien jou√©! Continuez comme √ßa!';
        } else if (percentage >= 50) {
          message = 'üìö Pas mal, mais vous pouvez mieux faire!';
        } else {
          message = 'üí™ Il faut r√©viser, mais ne vous d√©couragez pas!';
        }
        document.getElementById('score-message').textContent = message;
        document.getElementById('winner-announcement').style.display = 'none';
      }
      function showResults(results) {
        questionScreen.style.display = 'none';
        resultsScreen.style.display = 'block';
        const winnerAnnouncement = document.getElementById(
          'winner-announcement',
        );
        const winnerMessage = document.getElementById('winner-message');
        if (results.winner) {
          winnerAnnouncement.style.display = 'block';
          if (results.isWinner) {
            winnerMessage.innerHTML =
              'üéä F√âLICITATIONS ! üéä<br>Vous √™tes le GAGNANT de cet √©v√©nement !';
          } else {
            winnerMessage.innerHTML = `üèÜ Gagnant de l'√©v√©nement : Joueur ${results.winner.substring(0, 8)}...`;
          }
        } else {
          winnerAnnouncement.style.display = 'none';
        }
        const percentage = Math.round(
          (results.score / results.totalQuestions) * 100,
        );
        document.getElementById('final-score').textContent =
          `${results.score}/${results.totalQuestions}`;
        let message = '';
        if (results.joinedAt > 0) {
          message = `üì∫ Mode surveillance - Rejoint √† la question ${results.joinedAt + 1}`;
        } else if (percentage >= 80) {
          message = 'üèÜ Excellent ! Vous ma√Ætrisez le sujet !';
        } else if (percentage >= 60) {
          message = 'üëç Bien jou√© ! Continuez comme √ßa !';
        } else if (percentage >= 40) {
          message = 'üìö Pas mal, mais vous pouvez mieux faire !';
        } else {
          message = 'üí™ Il faut r√©viser, mais ne vous d√©couragez pas !';
        }
        document.getElementById('score-message').textContent = message;
      }
      function updatePlayerStats(stats) {
        document.getElementById('player-stats').style.display = 'flex';
        document.getElementById('active-players').textContent =
          stats.activePlayers;
        document.getElementById('watching-players').textContent =
          stats.watchingPlayers;
        document.getElementById('total-players').textContent =
          stats.totalPlayers;
      }
      function showEventBanner(event) {
        const banner = document.getElementById('event-banner');
        const details = document.getElementById('event-details');
        banner.style.display = 'block';
        details.innerHTML = `
        <div>Th√®me: ${event.theme}</div>
        <div>${event.numberOfQuestions} questions ‚Ä¢ Soyez le premier √† tout r√©ussir pour gagner !</div>
      `;
      }
      function hideEventBanner() {
        document.getElementById('event-banner').style.display = 'none';
      }
      function restartQuiz() {
        if (soloTimerInterval) {
          clearInterval(soloTimerInterval);
          soloTimerInterval = null;
        }
        resultsScreen.style.display = 'none';
        document.getElementById('mode-selection').style.display = 'block';
        document.getElementById('solo-config').style.display = 'none';
        document.getElementById('multiplayer-config').style.display = 'none';
        progressBar.style.width = '0%';
        document.getElementById('player-stats').style.display = 'none';
        document.getElementById('winner-announcement').style.display = 'none';
        gameMode = null;
        soloQuestions = [];
        currentSoloIndex = 0;
        soloScore = 0;
        if (
          document.getElementById('next-event-details').innerHTML &&
          document.getElementById('lobby-section').style.display !== 'block'
        ) {
          document.getElementById('next-event').style.display = 'block';
        }
      }
      function showNextEvent(event) {
        const nextEventDiv = document.getElementById('next-event');
        const detailsDiv = document.getElementById('next-event-details');
        if (
          document.getElementById('lobby-section').style.display === 'block'
        ) {
          return;
        }
        nextEventDiv.style.display = 'block';
        detailsDiv.innerHTML = `
        <div><strong>üéØ Th√®me:</strong> ${event.theme}</div>
        <div><strong>üìù Questions:</strong> ${event.numberOfQuestions}</div>
        <div><strong>üïê D√©but:</strong> ${new Date(event.startDate).toLocaleString('fr-FR')}</div>
      `;
        startEventCountdown(event.startDate);
        updateMultiplayerStatus();
      }
      function startEventCountdown(startDate) {
        const countdownDiv = document.getElementById('event-countdown');
        const updateCountdown = () => {
          const now = new Date().getTime();
          const eventTime = new Date(startDate).getTime();
          const timeLeft = Math.max(0, Math.floor((eventTime - now) / 1000));
          if (timeLeft > 0) {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            countdownDiv.innerHTML = `‚è∞ D√©but dans: ${hours}h ${minutes}m ${seconds}s`;
            countdownDiv.onclick = null;
            countdownDiv.style.cursor = 'default';
            const mpCountdownDiv =
              document.getElementById('mp-event-countdown');
            if (mpCountdownDiv) {
              mpCountdownDiv.innerHTML = countdownDiv.innerHTML;
              mpCountdownDiv.onclick = null;
              mpCountdownDiv.style.cursor = 'default';
            }
          } else {
            countdownDiv.innerHTML = 'üöÄ √âv√©nement en cours!';
            countdownDiv.onclick = () => joinLobby();
            countdownDiv.style.cursor = 'pointer';
            const mpCountdownDiv =
              document.getElementById('mp-event-countdown');
            if (mpCountdownDiv) {
              mpCountdownDiv.innerHTML = countdownDiv.innerHTML;
              mpCountdownDiv.onclick = () => joinLobby();
              mpCountdownDiv.style.cursor = 'pointer';
            }
          }
        };
        updateCountdown();
        setInterval(updateCountdown, 1000);
      }
      function showLobby(event) {
        document.getElementById('next-event').style.display = 'none';
        const lobbyDiv = document.getElementById('lobby-section');
        const detailsDiv = document.getElementById('lobby-details');
        const joinBtn = document.getElementById('join-lobby-btn');
        lobbyDiv.style.display = 'block';
        detailsDiv.innerHTML = `
        <div><strong>üéØ √âv√©nement:</strong> ${event.theme}</div>
        <div><strong>üìù Questions:</strong> ${event.numberOfQuestions}</div>
        <div><strong>üë• Joueurs requis:</strong> ${event.minPlayers}</div>
      `;
        joinBtn.textContent = 'üöÄ Rejoindre le Lobby';
        joinBtn.disabled = false;
        joinBtn.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
        window.currentEvent = event;
        updateMultiplayerStatus();
      }
      function updateEventCountdown(timeLeft, participants, minPlayers) {
        const countdownDiv = document.getElementById('lobby-countdown');
        const participantsDiv = document.getElementById('lobby-participants');
        if (timeLeft > 0) {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          countdownDiv.innerHTML = `‚è∞ D√©but dans: ${minutes}m ${String(seconds).padStart(2, '0')}s`;
        } else {
          countdownDiv.innerHTML = 'üöÄ Lancement!';
        }
        participantsDiv.innerHTML = `üë• Joueurs: ${participants}/${minPlayers}`;
        if (participants < minPlayers && timeLeft < 60) {
          participantsDiv.innerHTML +=
            '<br><small style="color: #ffeb3b;">‚ö†Ô∏è Pas assez de joueurs - √©v√©nement peut √™tre annul√©</small>';
        }
        if (document.getElementById('waiting-room').style.display === 'flex') {
          updateWaitingRoom(participants, minPlayers, timeLeft);
        }
        updateMultiplayerStatus();
      }
      function joinLobby() {
        if (lobbyOpen) {
          socket.emit('joinLobby');
          return;
        }

        if (pendingLobbyCheck) return;
        pendingLobbyCheck = true;

        // Interroger le serveur, puis tenter de rejoindre automatiquement si ouvert
        const oneTimeHandler = (data) => {
          socket.off('lobbyStatus', oneTimeHandler);
          pendingLobbyCheck = false;
          lobbyOpen = data.isOpen === true;
          if (data.isOpen && data.event) {
            showLobby(data.event);
            window.currentEvent = data.event;
            updateMultiplayerCard(null, data.event);
            socket.emit('joinLobby');
          } else {
            // Aucun lobby, tenter de rejoindre un √©v√©nement en cours
            socket.emit('joinInProgress');
          }
        };
        socket.on('lobbyStatus', oneTimeHandler);
        socket.emit('requestLobbyStatus');
      }
      function showLobbyJoined(data) {
        const joinBtn = document.getElementById('join-lobby-btn');
        joinBtn.textContent = '‚úÖ Dans le lobby';
        joinBtn.disabled = true;
        joinBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
        showWaitingRoom(data);
      }
      function updateLobbyParticipants(participants, minPlayers) {
        const participantsDiv = document.getElementById('lobby-participants');
        participantsDiv.innerHTML = `üë• Joueurs: ${participants}/${minPlayers}`;
      }
      function showWaitingRoom(data) {
        const waitingRoom = document.getElementById('waiting-room');
        const eventDetails = document.getElementById('waiting-event-details');
        waitingRoom.style.display = 'flex';
        if (window.currentEvent) {
          eventDetails.innerHTML = `
          <h3>üéØ ${window.currentEvent.theme}</h3>
          <p>üìù ${window.currentEvent.numberOfQuestions} questions</p>
          <p>üë• ${window.currentEvent.minPlayers} joueurs minimum</p>
        `;
        }
        document.body.style.overflow = 'hidden';
      }
      function updateWaitingRoom(participants, minPlayers, timeLeft) {
        const participantsGrid = document.getElementById('participants-grid');
        const waitingCountdown = document.getElementById('waiting-countdown');
        const waitingStatus = document.getElementById('waiting-status');
        if (timeLeft > 0) {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          waitingCountdown.innerHTML = `‚è∞ D√©but dans: ${minutes}m ${String(seconds).padStart(2, '0')}s`;
        } else {
          waitingCountdown.innerHTML = 'üöÄ Lancement imminent!';
        }
        participantsGrid.innerHTML = '';
        const avatarEmojis = [
          'üë§',
          'üßë',
          'üë©',
          'üßî',
          'üë®',
          'üßë‚Äçüíº',
          'üë©‚Äçüíº',
          'üßë‚Äçüéì',
          'üë©‚Äçüéì',
          'üßë‚Äçüíª',
        ];
        for (let i = 0; i < Math.max(participants, minPlayers); i++) {
          const avatar = document.createElement('div');
          avatar.className = 'participant-avatar';
          if (i < participants) {
            avatar.textContent = avatarEmojis[i % avatarEmojis.length];
            avatar.style.opacity = '1';
          } else {
            avatar.textContent = '‚è≥';
            avatar.style.opacity = '0.3';
            avatar.style.background = 'rgba(255, 255, 255, 0.2)';
          }
          participantsGrid.appendChild(avatar);
        }
        if (participants >= minPlayers) {
          waitingStatus.innerHTML = `<div style="color: #4CAF50; font-weight: bold;">‚úÖ Assez de joueurs! Le jeu va commencer...</div>`;
        } else {
          const needed = minPlayers - participants;
          waitingStatus.innerHTML = `<div style="color: #ffeb3b;">‚è≥ En attente de ${needed} joueur${needed > 1 ? 's' : ''} suppl√©mentaire${needed > 1 ? 's' : ''}...</div>`;
          if (timeLeft < 60) {
            waitingStatus.innerHTML += `<div style="color: #ff9800; font-size: 0.9em; margin-top: 10px;">‚ö†Ô∏è L'√©v√©nement peut √™tre annul√© si pas assez de joueurs</div>`;
          }
        }
      }
      function leaveLobby() {
        socket.emit('leaveLobby');
        document.getElementById('waiting-room').style.display = 'none';
        document.getElementById('lobby-section').style.display = 'block';
        document.body.style.overflow = 'auto';
        const joinBtn = document.getElementById('join-lobby-btn');
        joinBtn.textContent = 'üöÄ Rejoindre le Lobby';
        joinBtn.disabled = false;
        joinBtn.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
      }
      function showEventCancelled(data) {
        document.getElementById('waiting-room').style.display = 'none';
        document.getElementById('lobby-section').style.display = 'none';
        document.body.style.overflow = 'auto';
        showNotification(
          '‚ùå √âv√©nement annul√©: Pas assez de participants',
          'error',
        );
        if (document.getElementById('next-event-details').innerHTML) {
          document.getElementById('next-event').style.display = 'block';
        }
        updateMultiplayerStatus();
      }
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 10px;
        color: white;
        font-weight: bold;
        z-index: 10000;
        animation: slideInRight 0.3s ease;
        max-width: 300px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      `;
        switch (type) {
          case 'error':
            notification.style.background =
              'linear-gradient(45deg, #f44336, #d32f2f)';
            break;
          case 'success':
            notification.style.background =
              'linear-gradient(45deg, #4CAF50, #45a049)';
            break;
          default:
            notification.style.background =
              'linear-gradient(45deg, #2196F3, #1976D2)';
        }
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.animation = 'slideOutRight 0.3s ease';
          setTimeout(() => notification.remove(), 300);
        }, 80);
      }
      function updateMultiplayerStatus() {
        const noLobbyMessage = document.getElementById('no-lobby-message');
        const mpLobbySection = document.getElementById('mp-lobby-section');
        const mpNextEvent = document.getElementById('mp-next-event');
        const mainLobby = document.getElementById('lobby-section');
        const mainNextEvent = document.getElementById('next-event');

        if (mainLobby.style.display === 'block') {
          const lobbyDetails =
            document.getElementById('lobby-details').innerHTML;
          const lobbyCountdown =
            document.getElementById('lobby-countdown').innerHTML;
          const lobbyParticipants =
            document.getElementById('lobby-participants').innerHTML;
          const joinBtn = document.getElementById('join-lobby-btn');
          document.getElementById('mp-lobby-details').innerHTML = lobbyDetails;
          document.getElementById('mp-lobby-countdown').innerHTML =
            lobbyCountdown;
          document.getElementById('mp-lobby-participants').innerHTML =
            lobbyParticipants;
          const mpJoinBtn = document.getElementById('mp-join-lobby-btn');
          mpJoinBtn.textContent = joinBtn.textContent;
          mpJoinBtn.disabled = joinBtn.disabled;
          mpJoinBtn.style.background = joinBtn.style.background;
          mpLobbySection.style.display = 'block';
          mpNextEvent.style.display = 'none';
          noLobbyMessage.style.display = 'none';
        } else if (mainNextEvent.style.display === 'block') {
          const eventDetails =
            document.getElementById('next-event-details').innerHTML;
          const eventCountdown =
            document.getElementById('event-countdown').innerHTML;
          document.getElementById('mp-next-event-details').innerHTML =
            eventDetails;
          document.getElementById('mp-event-countdown').innerHTML =
            eventCountdown;
          mpNextEvent.style.display = 'block';
          mpLobbySection.style.display = 'none';
          noLobbyMessage.style.display = 'none';
        } else {
          mpLobbySection.style.display = 'none';
          mpNextEvent.style.display = 'none';
          noLobbyMessage.style.display = 'block';
        }
      }

      const style = document.createElement('style');
      style.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
      input:focus {
        border-color: #2196F3 !important;
        outline: none;
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }
    `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
